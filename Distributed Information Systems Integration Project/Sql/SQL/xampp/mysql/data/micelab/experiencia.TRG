TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `criarExperienciaLimiteBefore` BEFORE INSERT ON `experiencia` FOR EACH ROW BEGIN\nDECLARE lastDate DATETIME;\nDECLARE minTemp INT;\n\nSELECT experiencia.DataHoraFim INTO lastDate\nFROM experiencia\nWHERE experiencia.Anulada = 0 AND\nexperiencia.DataHoraFim >= ALL(SELECT DataHoraFim FROM\nexperiencia WHERE DataHoraFim IS NOT NULL);\n\n\nSELECT CAST(parametrosadicionais.Valor AS INTEGER ) INTO\nminTemp\nFROM parametrosadicionais\nWHERE parametrosadicionais.Agrupador =\n\'TEMPO_ENTRE_EXPERIENCIA\' AND\nparametrosadicionais.Identificador = \'TEMPO\';\n\n\nIF EXISTS(SELECT * FROm experiencia e WHERE\nABS(TIMESTAMPDIFF(MINUTE, new.DataHoraInicio,\ne.DataHoraInicio)) < (SELECT CAST(pa.Valor as INT) FROM\nparametrosadicionais pa WHERE\npa.Agrupador=\'TEMPO_ENTRE_EXPERIENCIA\' AND\npa.Identificador=\'TEMPO\')) THEN\nSIGNAL SQLSTATE \'45000\'\nSET MESSAGE_TEXT = "Nao foi possivel completar a\\r\\noperacao, existe uma experiencia a decorrer";\n\n\nEND IF;\n\nIF ABS (TIMESTAMPDIFF(MINUTE, lastDate,\nnew.DataHoraInicio) ) < minTemp THEN\nSIGNAL SQLSTATE \'45000\'\nSET MESSAGE_TEXT = "Nao foi possivel completar a\\r\\noperacao, por favor aguarde o tempo minimo entre\\r\\nexperiencias";\n\n\nEND IF;\n\nIF (new.DataHoraInicio<CURRENT_TIMESTAMP and\nTIMESTAMPDIFF(second, CURRENT_TIMESTAMP,\nnew.DataHoraInicio) > 1) THEN\nSIGNAL SQLSTATE \'45000\'\nSET MESSAGE_TEXT = "Nao foi possivel completar a\\r\\noperacao, nao é possivel comecar uma experiencia no\\r\\npassado";\n\nEND IF;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tipoUtilizadorExperienciaInsert` BEFORE INSERT ON `experiencia` FOR EACH ROW BEGIN\n\nIF EXISTS(SELECT * from utilizador where id = new.Investigador\nand tipo <> \'Investigador\') then\n\nSIGNAL SQLSTATE \'45000\' set MESSAGE_TEXT = \'Erro ao\\r\\ntentar associar um utilizador não investigador à\\r\\nexperiência\';\n\nend IF;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `validarDadosExperiencia` BEFORE INSERT ON `experiencia` FOR EACH ROW BEGIN\n\nSET new.Id = NULL;\nSET new.Populada = 0;\nSET new.Anulada = 0;\n\nIF(new.NumeroRatos<=0 OR new.LimiteRatosSala<=0 OR\nnew.SegundosSemMovimento <= 0 OR\nnew.VariacaoTemperaturaMaxima <=0 OR new.TemperaturaIdeal\n<= 0 OR new.DataHoraInicio >= new.DataHoraFim) THEN\n\nSIGNAL SQLSTATE \'45000\' SET MESSAGE_TEXT = \'Os dados\\r\\ninseridos não são válidos.\';\n\nEND IF;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `criarExperienciaLimiteAfter` AFTER INSERT ON `experiencia` FOR EACH ROW BEGIN\n\nINSERT INTO medicaosala (medicaosala.IdExperiencia,\nmedicaosala.Sala, medicaosala.NumeroRatos)\nVALUES (new.Id, 1, new.NumeroRatos);\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tipoUtilizadorExperienciaUpdate` BEFORE UPDATE ON `experiencia` FOR EACH ROW BEGIN\n\nif(SELECT 1 from utilizador where id = new.Investigador\nand tipo <> \'Investigador\') then\n\nSIGNAL SQLSTATE \'45000\' set MESSAGE_TEXT = \'Erro ao\\r\\ntentar associar um utilizador não investigador à\\r\\nexperiência\';\n\nend IF;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `validarDadosExperienciaUpdate` BEFORE UPDATE ON `experiencia` FOR EACH ROW BEGIN\n\nDECLARE minTemp INT;\nDECLARE usertipo VARCHAR(30);\n\nSELECT u.Tipo into usertipo\nFROM utilizador u\nWHERE u.Username = SUBSTRING_INDEX(USER(),\'@\',1);\n\nIF(usertipo<>\'Java\' AND usertipo<>\'AppAdmin\') AND\nnew.DataHoraInicio <> old.DataHoraInicio THEN\nSELECT CAST(parametrosadicionais.Valor AS INTEGER )\nINTO minTemp\nFROM parametrosadicionais\nWHERE parametrosadicionais.Agrupador =\n\'TEMPO_ENTRE_EXPERIENCIA\' AND\nparametrosadicionais.Identificador = \'TEMPO\';\n\nIF EXISTS(SELECT * FROm experiencia e WHERE\nABS(TIMESTAMPDIFF(MINUTE, new.DataHoraInicio,\ne.DataHoraInicio)) < (SELECT CAST(pa.Valor as INT) FROM\nparametrosadicionais pa WHERE\npa.Agrupador=\'TEMPO_ENTRE_EXPERIENCIA\' AND\npa.Identificador=\'TEMPO\')) THEN\nSIGNAL SQLSTATE \'45000\'SET MESSAGE_TEXT = "Nao foi possivel\\r\\ncompletar a operacao, existe uma experiencia a decorrer\\r\\nnuma diferença de tempo maximo entre experiencias do\\r\\nhorario escolhido";\n\nEND IF;\n\nIF (new.DataHoraInicio<CURRENT_TIMESTAMP and\nTIMESTAMPDIFF(second, CURRENT_TIMESTAMP,\nnew.DataHoraInicio) > 1) THEN\nSIGNAL SQLSTATE \'45000\' SET MESSAGE_TEXT = "Nao foi possivel completar a\\r\\noperacao, nao é possivel comecar uma experiencia no\\r\\npassado";\n\nEND IF;\n\nEND IF;\n\nEND'
sql_modes=524288 524288 524288 524288 524288 524288
definers='root@localhost' 'root@localhost' 'root@localhost' 'root@localhost' 'root@localhost' 'root@localhost'
client_cs_names='utf8mb4' 'utf8mb4' 'utf8mb4' 'utf8mb4' 'utf8mb4' 'utf8mb4'
connection_cl_names='utf8mb4_general_ci' 'utf8mb4_general_ci' 'utf8mb4_general_ci' 'utf8mb4_general_ci' 'utf8mb4_general_ci' 'utf8mb4_general_ci'
db_cl_names='latin1_bin' 'latin1_bin' 'latin1_bin' 'latin1_bin' 'latin1_bin' 'latin1_bin'
created=1684088299288268 1684088299306656 1684088299317154 1684088299284530 1684088299311972 1684088299324741
